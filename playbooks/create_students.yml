---
- hosts: a27-alumnes
  become: yes
  vars_files:
    - users/students.yml

  tasks:

  - name: Create student's regular users
    user:
      name: "{{ item.name }}"
      # mkpasswd --method=sha-512
      password: "{{ item.pass | password_hash('sha512') }}"
#      groups: # Empty by default, here we give it some groups
#       - docker
#       - sudo
      state: present
      shell: /bin/bash       # Defaults to /bin/bash
      system: no             # Defaults to no
      createhome: yes        # Defaults to yes
      home: /home/{{ item.name }}       # Defaults to /home/<username>
    with_items: "{{  students  }}"

  - name: Check if lightdm service exists (stat module)
    stat: path=/etc/init.d/lightdm
    register: service_stat

  - name: Check if lightdm service exists (service module)
    service: name=lightdm
    register: service

  - name: Restart lightdm service if exists and is running
    service: name=lightdm state=restarted
    when: service_stat.stat.exists and service.status.SubState == 'running'
    register: service_started
